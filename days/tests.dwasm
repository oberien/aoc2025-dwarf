#var tests {
    #debug 0
    call test_string_from_number
    #debug 1
    call test_string_slice
    #debug 2
    call test_string_split_at
    #debug 3
    call test_string_repeat
    #debug 4
    call test_bytearray_index_of
    #debug 5
    call test_bytearray_max
    #debug 6
    call test_rodata_reader_read_char
    #debug 7
    call test_rodata_reader_read_line
    #debug 8
    call test_pow
    #debug 9
    call test_rodata_reader_2d
    #debug 10
    call test_rodata_reader_try_read_number
    #debug 11
    call test_rodata_reader_next_number
    #debug 12
    call test_rodata_reader_next_non_whitespace_char
    #debug 13
    call test_rodata_reader_go_to_char
    #debug 14
    call test_rodata_reader_go_to_next_line
    #debug 15
    constu 1
}

#proc test_string_from_number {
    constu 1
    call string_from_number
    #create $String { len: 1, data: [0; 254] }
    #set $String.data[0] = 0x31
    #if (dup) != (pick 2) {
        constu 8907431894709842397
        call panic
    }
    drop
    drop

    constu 421337
    call string_from_number
    #create $String { len: 6, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32
    #set $String.data[2] = 0x31
    #set $String.data[3] = 0x33
    #set $String.data[4] = 0x33
    #set $String.data[5] = 0x37
    #if (dup) != (pick 2) {
        constu 4896515384654835
        call panic
    }
    drop
    drop
}

#proc test_string_slice {
    #create $String { len: 6, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32
    #set $String.data[2] = 0x31
    #set $String.data[3] = 0x33
    #set $String.data[4] = 0x33
    #set $String.data[5] = 0x37

    dup
    constu 0
    constu 3
    call string_slice
    #create $String { len: 3, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32
    #set $String.data[2] = 0x31
    #if (dup) != (pick 2) {
        constu 41683546574532
        call panic
    }
    drop
    drop

    dup
    constu 3
    constu 6
    call string_slice
    #create $String { len: 3, data: [0; 254] }
    #set $String.data[0] = 0x33
    #set $String.data[1] = 0x33
    #set $String.data[2] = 0x37
    #if (dup) != (pick 2) {
        constu 20938450791982
        call panic
    }
    drop
    drop

    dup
    constu 2
    constu 4
    call string_slice
    #create $String { len: 2, data: [0; 254] }
    #set $String.data[0] = 0x31
    #set $String.data[1] = 0x33
    #if (dup) != (pick 2) {
        constu 375489615334
        call panic
    }
    drop
    drop

    drop
}

#proc test_string_split_at {
    #create $String { len: 6, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32
    #set $String.data[2] = 0x31
    #set $String.data[3] = 0x33
    #set $String.data[4] = 0x33
    #set $String.data[5] = 0x37

    dup
    constu 3
    call string_split_at
    #create $String { len: 3, data: [0; 254] }
    #set $String.data[0] = 0x33
    #set $String.data[1] = 0x33
    #set $String.data[2] = 0x37
    #if (dup) != (pick 2) {
        constu 485612348988
        call panic
    }
    drop
    drop
    #create $String { len: 3, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32
    #set $String.data[2] = 0x31
    #if (dup) != (pick 2) {
        constu 1098724309
        call panic
    }
    drop
    drop

    dup
    constu 1
    call string_split_at
    #create $String { len: 5, data: [0; 254] }
    #set $String.data[0] = 0x32
    #set $String.data[1] = 0x31
    #set $String.data[2] = 0x33
    #set $String.data[3] = 0x33
    #set $String.data[4] = 0x37
    #if (dup) != (pick 2) {
        constu 56483128648645
        call panic
    }
    drop
    drop
    #create $String { len: 1, data: [0; 254] }
    #set $String.data[0] = 0x34
    #if (dup) != (pick 2) {
        constu 784655123459
        call panic
    }
    drop
    drop

    drop
}

#proc test_string_repeat {
    #create $String { len: 2, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32

    dup
    constu 3
    call string_repeat
    #create $String { len: 6, data: [0; 254] }
    #set $String.data[0] = 0x34
    #set $String.data[1] = 0x32
    #set $String.data[2] = 0x34
    #set $String.data[3] = 0x32
    #set $String.data[4] = 0x34
    #set $String.data[5] = 0x32
    #if (dup) != (pick 2) {
        constu 784681538
        call panic
    }
    drop
    drop

    drop
}

#proc test_bytearray_index_of {
    #create $Bytearray { len: 6, data: [0; 254] }
    #set $String.data[0] = 1
    #set $String.data[1] = 1
    #set $String.data[2] = 2
    #set $String.data[3] = 4
    #set $String.data[4] = 8
    #set $String.data[5] = 16

    dup
    constu 1
    call bytearray_index_of
    #if (dup) != (constu 0) {
        constu 48961532454638
        call panic
    }
    drop

    dup
    constu 2
    call bytearray_index_of
    #if (dup) != (constu 2) {
        constu 4861543245498
        call panic
    }
    drop

    dup
    constu 4
    call bytearray_index_of
    #if (dup) != (constu 3) {
        constu 189263498710982
        call panic
    }
    drop

    dup
    constu 8
    call bytearray_index_of
    #if (dup) != (constu 4) {
        constu 678913132578
        call panic
    }
    drop

    dup
    constu 16
    call bytearray_index_of
    #if (dup) != (constu 5) {
        constu 89712639784071982
        call panic
    }
    drop

    dup
    constu 3
    call bytearray_index_of
    #if (dup) != (consts -1) {
        constu 981293787473120
        call panic
    }
    drop

    drop
}

#proc test_bytearray_max {
    #create $Bytearray { len: 4, data: [0; 254] }
    #set $String.data[0] = 1
    #set $String.data[1] = 10
    #set $String.data[2] = 8
    #set $String.data[3] = 10

    dup
    call bytearray_max
    #if (dup) != (constu 10) {
        constu 10923489471230
        call panic
    }
    drop

    drop
}

#rodata test_rodata_reader_data {
    #u8 'a', 'b', 'c', '\n', '\n', 'd', 'e', '\n'
}
#proc test_rodata_reader_read_char {
    addr test_rodata_reader_data
    addr test_rodata_reader_data.len
    call rodata_reader_new

    call rodata_reader_read_char
    #if (dup) != (constu 'a') {
        constu 12987318
        call panic
    }
    drop

    call rodata_reader_read_char
    #if (dup) != (constu 'b') {
        constu 98027359821
        call panic
    }
    drop

    call rodata_reader_read_char
    #if (dup) != (constu 'c') {
        constu 1983274898
        call panic
    }
    drop

    call rodata_reader_read_char
    #if (dup) != (constu '\n') {
        constu 3247189193274
        call panic
    }
    drop

    drop
}
#proc test_rodata_reader_read_line {
    addr test_rodata_reader_data
    addr test_rodata_reader_data.len
    call rodata_reader_new

    call rodata_reader_read_line
    #create $String { len: 3, data: [0; 254] }
    #set $String.data[0] = 'a'
    #set $String.data[1] = 'b'
    #set $String.data[2] = 'c'
    #if (dup) != (pick 2) {
        constu 91780269034
        call panic
    }
    drop
    drop

    call rodata_reader_read_line
    #create $String { len: 0, data: [0; 254] }
    #if (dup) != (pick 2) {
        constu 987123679423
        call panic
    }
    drop
    drop

    call rodata_reader_read_line
    #create $String { len: 2, data: [0; 254] }
    #set $String.data[0] = 'd'
    #set $String.data[1] = 'e'
    #if (dup) != (pick 2) {
        constu 9217438327689
        call panic
    }
    drop
    drop

    call rodata_reader_is_eof
    #if (dup) != (constu 1) {
        constu 198032478399
        call panic
    }
    drop

    drop
}

#proc test_pow {
    constu 2
    constu 0
    call pow
    #if (dup) != (constu 1) {
        constu 8456312846
        call panic
    }
    drop

    constu 2
    constu 1
    call pow
    #if (dup) != (constu 2) {
        constu 24789209832047
        call panic
    }
    drop

    constu 2
    constu 2
    call pow
    #if (dup) != (constu 4) {
        constu 902389742367438743
        call panic
    }
    drop

    constu 2
    constu 3
    call pow
    #if (dup) != (constu 8) {
        constu 90863478940320987
        call panic
    }
    drop
}

#rodata test_rodata_reader_2d_data1 {
    #u8 'a', 'b', 'c', '\n', 'd', 'e', 'f', '\n'
}
#rodata test_rodata_reader_2d_data2 {
    #u8 'a', 'b', 'c', '\n', 'd', 'e', 'f'
}
#proc test_rodata_reader_2d {
    addr test_rodata_reader_2d_data1
    addr test_rodata_reader_2d_data1.len
    call test_rodata_reader_2d_internal
    addr test_rodata_reader_2d_data2
    addr test_rodata_reader_2d_data2.len
    call test_rodata_reader_2d_internal
}
#proc test_rodata_reader_2d_internal {
    call rodata_reader_2d_new

    dup
    #get $RodataReader2D.width
    #if (dup) != (constu 3) {
        constu 8905492378490
        call panic
    }
    drop

    dup
    #get $RodataReader2D.height
    #if (dup) != (constu 2) {
        constu 92374279
        call panic
    }
    drop

    constu 0
    constu 0
    constu 'X'
    call rodata_reader_2d_get_default
    #if (dup) != (constu 'a') {
        constu 89704302890
        call panic
    }
    drop

    constu 1
    constu 1
    constu 'X'
    call rodata_reader_2d_get_default
    #if (dup) != (constu 'e') {
        constu 92087345479
        call panic
    }
    drop

    constu 2
    constu 1
    constu 'X'
    call rodata_reader_2d_get_default
    #if (dup) != (constu 'f') {
        constu 23409782043872
        call panic
    }
    drop

    constu 2
    constu 2
    constu 'X'
    call rodata_reader_2d_get_default
    #if (dup) != (constu 'X') {
        constu 734652827346578384
        call panic
    }
    drop

    drop
}

#rodata test_rodata_reader_try_read_number_data {
    #u8 '1', '2', '3', '\n', '\n', 'a', '-', '4', '\n'
}
#proc test_rodata_reader_try_read_number {
    addr test_rodata_reader_try_read_number_data
    addr test_rodata_reader_try_read_number_data.len
    call rodata_reader_new

    call rodata_reader_try_read_number
    #if (dup) != (constu 123) {
        constu 4329087409824
        call panic
    }
    drop

    call rodata_reader_try_read_number
    #if (dup) != (consts -1) {
        constu 25782092349780
        call panic
    }
    drop

    // consume '\n'
    call rodata_reader_read_char
    drop

    call rodata_reader_try_read_number
    #if (dup) != (consts -1) {
        constu 2978954278029734
        call panic
    }
    drop

    // consume '\n'
    call rodata_reader_read_char
    drop

    call rodata_reader_try_read_number
    #if (dup) != (consts -1) {
        constu 98023750942380973
        call panic
    }
    drop

    // consume 'a'
    call rodata_reader_read_char
    drop

    call rodata_reader_try_read_number
    #if (dup) != (consts -1) {
        constu 397428597298379
        call panic
    }
    drop

    // consume '-'
    call rodata_reader_read_char
    drop

    call rodata_reader_try_read_number
    #if (dup) != (constu 4) {
        constu 642624287544387345
        call panic
    }
    drop

    call rodata_reader_try_read_number
    #if (dup) != (consts -1) {
        constu 84378743738343764
        call panic
    }
    drop

    drop
}
#proc test_rodata_reader_next_number {
    addr test_rodata_reader_try_read_number_data
    addr test_rodata_reader_try_read_number_data.len
    call rodata_reader_new

    call rodata_reader_next_number
    #if (dup) != (constu 123) {
        constu 29043872034
        call panic
    }
    drop

    call rodata_reader_next_number
    #if (dup) != (constu 4) {
        constu 23948457029874
        call panic
    }
    drop

    call rodata_reader_next_number
    #if (dup) != (consts -1) {
        constu 234978520877
        call panic
    }
    drop

    drop
}
#rodata rodata_reader_next_non_whitespace_char_data {
    #u8 'a', ' ', '\t', '\n', '\r', 'b', 'c'
}
#proc test_rodata_reader_next_non_whitespace_char {
    addr rodata_reader_next_non_whitespace_char_data
    addr rodata_reader_next_non_whitespace_char_data.len
    call rodata_reader_new

    call rodata_reader_next_non_whitespace_char
    #if (dup) != (constu 'a') {
        constu 142790842897
        call panic
    }
    drop

    call rodata_reader_next_non_whitespace_char
    #if (dup) != (constu 'b') {
        constu 249873402987278
        call panic
    }
    drop

    call rodata_reader_next_non_whitespace_char
    #if (dup) != (constu 'c') {
        constu 323780942387023
        call panic
    }
    drop

    call rodata_reader_next_non_whitespace_char
    #if (dup) != (consts -1) {
        constu 3845748747843
        call panic
    }
    drop

    drop
}
#rodata rodata_reader_go_to_char_data {
    #u8 'a', 'b', '\n', 'c'
}
#proc test_rodata_reader_go_to_char {
    addr rodata_reader_go_to_char_data
    addr rodata_reader_go_to_char_data.len
    call rodata_reader_new

    constu 'a'
    call rodata_reader_go_to_char
    #if (dup) != (constu 0) {
        constu 789342080098
        call panic
    }
    drop

    constu '\n'
    call rodata_reader_go_to_char
    #if (dup) != (constu 0) {
        constu 445794897547894
        call panic
    }
    drop

    constu 'd'
    call rodata_reader_go_to_char
    #if (dup) != (consts -1) {
        constu 47853978349
        call panic
    }
    drop

    drop
}

#rodata rodata_reader_go_to_next_line_data {
    #u8 'a', 'b', '\n', 'c', '\n', '\n', 'd'
}
#proc test_rodata_reader_go_to_next_line {
    addr rodata_reader_go_to_next_line_data
    addr rodata_reader_go_to_next_line_data.len
    call rodata_reader_new

    call rodata_reader_go_to_next_line
    #if (dup) != (constu 0) {
        constu 23923923909802
        call panic
    }
    drop
    #if (dup, #get $RodataReader.address) != (addr rodata_reader_go_to_next_line_data, constu 3, plus) {
        constu 349782298347834
        call panic
    }

    call rodata_reader_go_to_next_line
    #if (dup) != (constu 0) {
        constu 234789324789
        call panic
    }
    drop
    #if (dup, #get $RodataReader.address) != (addr rodata_reader_go_to_next_line_data, constu 5, plus) {
        constu 1373421675862
        call panic
    }

    call rodata_reader_go_to_next_line
    #if (dup) != (constu 0) {
        constu 129032340942309
        call panic
    }
    drop
    #if (dup, #get $RodataReader.address) != (addr rodata_reader_go_to_next_line_data, constu 6, plus) {
        constu 834764564867469394
        call panic
    }

    // test go_to_last_line: check if a fresh reader gone to the last line equals
    // our test-reader that is currently at the beginning of the last line
    addr rodata_reader_go_to_next_line_data
    addr rodata_reader_go_to_next_line_data.len
    call rodata_reader_new
    call rodata_reader_go_to_last_line
    #if (dup) != (pick 2) {
        constu 3497597842973498
        call panic
    }
    drop

    call rodata_reader_go_to_next_line
    #if (dup) != (consts -1) {
        constu 854477388783476
        call panic
    }
    drop

    drop
}
